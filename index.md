
## Documentation
**This is the page that centralizes all documentation of the tables available in Looker. In the side menu you will find the links to access the wikis of each table.**


### Invoice Line 

   **This is the detailed documentation of the invoice lines table. Each record in the table represents one row of an invoice. It is the source table for any revenue analysis from which other tables are derived. Below are all columns in the table, each accompanied by a description and other relevant information.** 

 - **Bike Id (bike_id)**
   - **Tipo**: numeric
   - **Description**: Unique identifier of the bike within a given project / square.
   - **Example Value**: 199
   - **Use case**: In order to know which bike has most charged late delivery usage charge you need to use this field to count after filtering for “Bike Rental Fee” lines (item_type = 2) that had the amount paid.
<br><br>

- **Cost (cost)**
   - **Tipo**: numeric
   - **Description**: total cost of invoice line. The value is obtained by multiplying the unit cost (Unit Cost) by the unit quantity (Unit Count). Invoices generated by projects outside Brazil will have this value in local currency, for projects in Brazil the value is in Reais.
   - **Example Value**: 300
   - **Use case**: To know the monthly revenue of plans sold you need to make the sum of the values of this field in the period of the month.
  <br><br>
- **Creation Time (creation_time)**
   - **Tipo**: date
   - **Description**: date and time of sale generation in the database, in the format (yyyy-mm-dd hh: mm: ss)
   - **Example Value**: 2019-08-20 14:42:41
   - **Use case**: To know the number of sales made in any given period, simply use this column as a filter to select the desired period.
  <br><br>
- **Creator(creator)**
   - **Tipo**: text
   - **Description**: call operator alias / username that manually created invoice line
   - **Example Value**: fmaroldi
   - **Use case**: To get the total amount of discounts applied by a given operator, you must add the total cost of discounts applied by filtering by this field.
  <br><br>
- **Customer Id (customer_id)**
   - **Tipo**: text
   - **Description**: customer's unique identifier within a given project / square. This field is not a unique customer identifier for the entire database, because between different squares the identifying numbers can be repeated. When used in conjunction with the “project” field, it results in a unique identifier for every Invoice Lines table client.
   - **Example Value**:1432967
   - **Use case**: To count any unique users in the table you will need to count on this field, ie how many unique users purchased subscribers plans in the last month
  <br><br>
- **Description(description)**
   - **Tipo**: text
   - **Description**: field that describes in more detail what the invoice line is about. In some cases, such as reversal, the description field holds the reference invoice line ID. This field can be automatically filled in by the system, for example in plan purchase lines, but can also be filled in by the fulfillment operator in cases of manual line generation.
   - **Example Value**: Installment Annual Plan (x12): # 4/12
   - **Use case**:This field is consulted for information purposes only and is not normally included in analyzes.
  <br><br>


- **Gift Certificate Id (gift_certificate_id)**
   - **Tipo**: numeric
   - **Description**: indicates the discount coupon ID applied. This field is null for all rows except “discount” (item_type = 6). Important to remember that discount coupon ID is also unique per square only
   - **Example Value**: 43150
   - **Use case**:In order to know the total value of discounts given in reais through a specific discount coupon, you must add the value of the cost field by filtering by the coupon ID to be analyzed.
  <br><br>
- **Invoice Date Paid (invoice_date_paid)**
   - **Tipo**: date
   - **Description**: date and time of registration of the sale payment in the database, in the format (yyyy-mm-dd hh: mm: ss)
   - **Example Value**: 2019-02-13 14:42:41
   - **Use case**:To know the actual amount of revenue earned in a certain period, just use this column as a filter to select the desired period.
  <br><br>
- **Invoice Id (invoice_id)**
   - **Tipo**: numeric
   - **Description**:unique invoice identifier within a certain project / square. This field is not a unique invoice identifier for the entire database, because between different squares the identifier numbers can be repeated. When used in conjunction with the “project” field, it gives you a unique identifier for every Invoice Lines table invoice.
   - **Example Value**: 2286048
   - **Use case**:This field is consulted for information purposes only and is not normally included in analyzes.
  <br><br>

- **Invoice Last Payment Attempt Date (invoice_last_payment_attempt_date)**
   - **Tipo**: date
   - **Description**:Date and time of registration in the database of the last attempt to pay the invoice line to the customer's credit card. The date is in the format (yyyy-mm-dd hh: mm: ss)
   - **Example Value**: 2018-09-28 15:00:31
   - **Use case**:This field is consulted for information purposes only and is not normally included in analyzes.
  <br><br>
- **Invoice Line Id (invoice_line_id)**
   - **Tipo**: numeric
   - **Description**:Unique identifier of the invoice line within a given project / square. This field is not a unique invoice line identifier for the entire database, because between different squares the identifier numbers can be repeated. When used in conjunction with the “project” field, it results in a unique identifier for every Invoice Lines table record.
   - **Example Value**: 3666137
   - **Use case**:To know the total number of items (rows) within an invoice you need to filter by the invoice of interest and make a count on the different values of this field.
  <br><br>

- **Invoice Line Reference (invoice_line_reference)**
   - **Tipo**: numeric
   - **Description**:stores the reference ID of the invoice line to which the line refers. This field is mainly filled in the table rows that represent applied discounts. In these cases, the ID in this field references the invoice line that represents the purchase of some plan. This reference is required to know which purchase the discount is being applied to.
   - **Example Value**: 2325733
   - **Use case**:To know the total discounts applied on plans that cost more than $ 100, you need to use this field to filter only those plans that cost more than $ 100
  <br><br>

- **Invoice Payment Attempts (invoice_payment_attempts)**
   - **Tipo**: numeric
   - **Description**:indicates the number of times the system has attempted to charge the invoice line amount to the customer's credit card
   - **Example Value**: 3
   - **Use case**:This field is consulted for information purposes only and is not normally included in analyzes.
  <br><br>
- **Invoice Payment Failed (invoice_payment_failed)**
   - **Tipo**: boolean (True/False)
   - **Description**:Indicates if the invoice amount failed to be charged to the customer's credit card
   - **Example Value**:
   - -**true**: indicates a failure
   - -**false**: indicates that no discount was applied on the sale analyzed
   - **Use case**:We do not recommend using this field for any payment analysis because it is not consistent. We have an open ticket with PBSC to confirm your reliability.
  <br><br>

- **Invoice Status**
   - **Tipo**: Text
   - **Description**:invoice processing status
   - **Example Value**:
    -1: UNCERTAIN AT GATEWAY - means the invoice has entered the payment stream but the system that operates it has not yet received confirmation if the payment was successful or if there was an error.
    0: BEING PROCESSED - means the invoice is being routed to the payment stream.
    1: PAID - means the invoice was successfully paid, properly debited from the customer's credit card.
    2: UNPAID - means the invoice has not yet been paid but must be processed by the payments system.
    3: HOLD - means that the invoice is a security charge that, despite being posted, was not charged to the customer's credit card.
    4: CANCELLED - means the invoice has been canceled and will not generate any debit from the customer's credit card.
    5: HOLD COMPLETE - means that the security charge of HOLD status has in fact been fully or partially debited from the customer's credit card due to a failure to pay another invoice.
    6: HOLD FAILED - Indicates an invoice whose security charge failed to be debited from the customer's credit card.
    7: UNPAID NO CC - significa que a invoice não foi paga e que não há informação de cartão de crédito para ser processada pelo sistema de pagamento.  Planos comprados com cartão de débito ou dinheiro, na praça ou nos bicicletários, quando corretamente inseridos entram na base com o status UNPAID NO CC ou PAID NO CC (abaixo)
    8: PAID NO CC - significa que a invoice foi paga e que não há informação de cartão de crédito para ser processada pelo sistema de pagamento, isto é, foi paga por processos externos como débito direto na máquina de cartão ou recebimento em dinheiro nas praças ou bicicletários
    9: PLANNED CANCELLATION: significa que uma ordem de cancelamento foi enviada ao sistema de pagamento mas ainda não foi confirmada
    10: FAILED CANCELLATION: significa que a ordem de cancelamento foi processada pelo sistema de pagamento mas falhou durante a execução
    11: WAITING CONFIRMATION: significa que a invoice foi submetida e recebida pelo sistema de pagamentos, mas este ainda não enviou a confirmação de que a invoice foi processada

   - **Use case**:To know what the actual amount collected in a given period will need to use this field as a filter to select only invoices with status equal to PAID
  <br><br>

- **Invoice Total (invoice_total)**
   - **Tipo**: numeric
   - **Description**:indicates the total invoice amount, considering discounts applied, the security amount credited to the customer's credit card statement, and other possible changes. This field always has the most up-to-date value, even in the old records. For example, imagine an invoice containing 4 records:
   1 - Monthly Plan - + R $ 60,00
  2 - Monthly Plan Discount - -R $ 30,00
  3 - Bike Rental Fee - + R $ 5,00
  4 - Bike Rental Fee - + R $ 5,00
  In this case, the value of this field will be 40, as a result of the 60 from the purchase of the monthly plan, minus 30 from the discount, plus the two usage fee charges of 5 reais. The final value is updated in all records that make up the invoice.
   - **Example Value**: 13,37
   - **Use case**:To know the actual revenue received in a specific month just add the values ​​of this field within the desired period
  <br><br>

- **Item Type(item_type)**
   - **Tipo**: text
   - **Description**:identifies the type of the invoice line item. This field is important to identify the type of revenue the invoice line refers to.
   - **Example Value**:
    1: (SUB) Subscription - line generated automatically by purchasing a plan. The Description field contains the name of the purchased plan. Your amount is refundable
    2: (BRF) Bike Rental Fee - line automatically generated per trip (also known as usage fee). Even trips that do not generate fees are recorded in the Invoice Lines table, but cost 0. Their value is refundable.
    3: (HOLD) Hold Amount - line automatically generated when the security amount is credited to the customer's card statement. Your amount is refundable
    4: (PARK) Parking - line normally generated by service operators, without a single meaning, that is, it may indicate a purchase of a discounted plan, it may indicate the application of a discount, a charge for an overage, a chargeback , and many other cases. For analysis on this type of item it is recommended to check the contents of the Description field, for a better understanding of what each line is about. Your amount is refundable
    5: (STOLEN) Stolen Bike Fee - line generated automatically upon confirmation that a particular bike has been stolen. The value of this line is the amount to be charged to the user, usually considering the total loss of the bike. Usually lines of this type are generated by call operators. For analysis on this type of item it is recommended to check the contents of the Description field, for a better understanding of what each line is about. Your amount is refundable
    6: (DISCOUNT) Discount - line generated manually by an attendant operator or automatically from the use of a coupon or discount code. Your amount is non-refundable.
    7: (MISC) Miscellaneous - line manually generated by operators, without a unique meaning. For analysis on this type of item it is recommended to check the contents of the Description field, for a better understanding of what each line is about. Your amount is refundable
    8: (REFUND) Refund - Manually generated line when a particular invoice plan purchase line (item_type = 1) is refunded. The invoice line ID and invoice line for which the refund is applied are in the Refunds Invoice Line Id and Refunded Invoice ID fields, respectively. The value of the Descriptions field in this line type also usually contains the invoice line ID to which the refund applies. Your amount is non-refundable.
    9: (MAXUS) Maximum Usage Fee - line manually generated by operators, without a unique meaning. For analysis on this type of item it is recommended to check the contents of the Description field, for a better understanding of what each line is about. Your amount is refundable
    10: (CARRIED) Carried Amount - line automatically generated when the security amount is charged from the user but does not cover the total invoice amount. In such cases, a line of this type with a negative value is generated on the reference invoice to adjust the total invoice amount, then another line of this type is also generated on the same invoice with the amount left to be paid. When the line value of this type is negative, its value is not refundable. When the value is positive, its value is refundable.
    11: (KEY) Key Replacement - A line manually generated by operators without a unique meaning. For analysis on this type of item it is recommended to check the contents of the Description field, for a better understanding of what each line is about. Your amount is refundable
    12: (CREDIT) Manual Discount - line manually generated by a call operator to offer a certain discount to a customer. This line type has no reference to another invoice line, unlike type 6 (DISCOUNT) lines. Your amount is non-refundable.

   - **Use case**:To calculate the total discounts applied in a given period you must add the value (Cost) of the rows filtering by this field (rows with item_type = 6)
   - **Documentação PBSC**:[clique aqui](https://confluence.publicbikesystem.net/display/CD/Appendix+-+Invoice+Line+Types)

  <br><br>

- **Modification Time**
   - **Tipo**: date
   - **Description**:date and time of the last change made to this invoice line. The date is in the format (yyyy-mm-dd hh: mm: ss)
   - **Example Value**: 2018-03-13 11:53:44
   - **Use case**:This field is consulted for information purposes only and is not normally included in analyzes.
  <br><br>
- **Project (project)**
   - **Tipo**: text
   - **Description**:Indica o projeto/praça no qual aquela venda foi realizada
   - **Example Value**: BIKESAMPA
                        BIKERIO
                        BIKESSA
                        BIKEPE
                        BIKEVV
                        BIKEPOA
                        BIKESANTIAGO
                        BAECOBICI

   - **Use case**:To know the total revenue collected over a given period and project, you will need to use this field as a filter by selecting the project (s) you are interested
  <br><br>

- **Purchase At Station (purchase_at_station)**
   - **Tipo**: numeric
   - **Description**:indicates the ID of the station from which the plan was purchased, in case of item_type = 1(purchase of plans), and the ID of the station from which the bike was taken, in case of item_type = 2(registration of travel done. Although), in the case of item_type = 2, the value of this field is the ID of the station from which the user removed the bike, the line in the invoice table is only generated when the user delivers the bike to the destination station. Important to remember that the station ID is also unique only per square.
   - **Example Value**: 24
   - **Use case**:To know which stations generated the most usage charges in a given period, you need to filter the “usage rate” lines that were actually paid by the customer, then count the number of hits by station and sort in descending way
  <br><br>

- **Refunded (refunded)**
   - **Tipo**: booleano (true/false)
   - **Description**:indicates whether the row value has been reversed or not
   - **Example Value**: true: indicates that the invoice amount has been reversed to the customer
                        false: indicates that no invoice amount has been reversed
   - **Use case**:To calculate the total chargebacks applied in a given period you must add the value (Cost) of the rows filtering by this field (rows with refunded = true)
  <br><br>

- **Refunded Invoice Id (refunded_invoice_id)**
   - **Tipo**: numeric
   - **Description**:stores the invoice reference ID to which the line refers. This field is populated on lines of type "reversal" (item_type = 8). In these cases, the ID in this field refers to the invoice that has some line that represents the purchase of some plan whose value has been fully or partially refunded. This reference is complementary to the reference to the invoice line, made by the field “Refunds Invoice Line Id”.
   - **Example Value**: 16963
   - **Use case**: This field is consulted for information purposes only and is not normally included in analyzes.
  <br><br>

- **Refunds Invoice Line Id (refunds_invoice_line_id)**
   - **Tipo**: numeric
   - **Description**:stores the reference ID of the invoice line to which the line refers. This field is populated on lines of type "reversal" (item_type = 8). In these cases, the ID in this field references the invoice line that represents the purchase of some plan that has been fully or partially refunded. This reference is required to know which purchase the refund is being applied to.
   - **Example Value**: 43150
   - **Use case**: To know the total refunds provided on plans that cost more than $ 100, you need to use this field to filter through only those plans that cost more than $ 100
  <br><br>

- **Taxable Amount (taxable_amount)**
   - **Tipo**: numeric
   - **Description**:invoice amount that can be taxed
   - **Example Value**: 300
   - **Use case**: This field is consulted for information purposes only and is not normally included in analyzes.
  <br><br>

- **Unit Cost (unit_cost)**
   - **Tipo**: numeric
   - **Description**:unit cost of invoice line
   - **Example Value**: 8
   - **Use case**: This field is mainly used to calculate the value of the Cost field by multiplying its value with that of the Unit Count field. This value also represents the price of the plan acquired on that sale on that specific date.
  <br><br>


- **Unit Cost (unit_cost)**
   - **Tipo**: numeric
   - **Description**:invoice line item unit quantity
   - **Example Value**: 2
   - **Use case**: This field is mainly used to calculate the value of the Cost field by multiplying its value with that of the Unit Cost field.
  <br><br>
